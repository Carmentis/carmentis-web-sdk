/**
  (c)2022-2024 Carmentis SAS
  Built 2024-04-23T10:25:35.487Z
*/
var Carmentis=function(e){"use strict";let t,n,a,r;function i(e){let t=[0];return[...e].forEach(((n,a)=>{t[e.length-a-1]=parseInt(n,16)})),function(e){let t=new Uint16Array(e.length+3>>2);for(let n=0;n<e.length;n+=4)t[n>>2]=e[n]|e[n+1]<<4|e[n+2]<<8|e[n+3]<<12;return{value:t,sign:0}}(t)}let c=new TextEncoder,o=new TextDecoder;const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";const l={NAME:"AES-CTR",ALGORITHM:"A256CTR",KEY_LENGTH:256,COUNTER_BITS:64},u={NAME:"AES-GCM",ALGORITHM:"A256GCM",KEY_LENGTH:256,TAG_LENGTH:96};async function y(e){let t=await async function(e){return await a("jwk",e)}(e);return n=t.k,new Uint8Array(function(e,t){let n=0,a=0,r=[];e+=t[64].repeat(3&-e.length);for(let i=0;i<e.length;){let c=t.indexOf(e[i++]);n+=64==c,a=a<<6|c,3&i||r.push(a>>16&255,a>>8&255,255&a)}return new Uint8Array(n?r.slice(0,-n):r)}(n,s));var n}function p(e){let t=new Uint8Array(16);if("number"==typeof e)t[7]=e;else{if(!(e instanceof Uint8Array&&8==e.length))throw"invalid nonce";t.set(e,0)}return t}async function d(e,t,n){return await async function(e,t,n,a){try{let i=await r({name:e.NAME,...t},n,a);return new Uint8Array(i)}catch(e){return!1}}(u,{iv:n,tagLength:u.TAG_LENGTH},e,t)}async function f(e){let n=await t("SHA-256",e);return new Uint8Array(n)}i("5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B"),i("FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF");const m=crypto.subtle,h=crypto.getRandomValues.bind(crypto),w=m.digest.bind(m),k=m.generateKey.bind(m),g=m.deriveKey.bind(m),b=m.importKey.bind(m),A=m.exportKey.bind(m),v=m.encrypt.bind(m),E=m.decrypt.bind(m),B=m.sign.bind(m),F=m.verify.bind(m);var C=Object.freeze({__proto__:null,decrypt:E,deriveKey:g,digest:w,encrypt:v,exportKey:A,generateKey:k,getRandomValues:h,importKey:b,sign:B,verify:F});const I=0,L=2,M=3,T=259,_=255,S=0,x=1,K=2,H=3,R=4,z=5,O=6,U=7,j=8,D=9,N=10,G=11,P=12,q=13,V=14,Y=G,$={0:[],2:[{name:"firstBlockId",type:z},{name:"count",type:x}],3:[{name:"id",type:z}],4:[{name:"id",type:Y}],5:[{name:"id",type:Y}],6:[{name:"id",type:Y}],7:[{name:"list",type:j,content:{type:Y}}],8:[{name:"type",type:x},{name:"name",type:O}],9:[{name:"id",type:Y}],16:[{name:"data",type:D}],32:[{name:"data",type:D}],33:[{name:"hash",type:Y}],128:[],129:[{name:"id",type:Y}],130:[{name:"string",type:O}],131:[{name:"data",type:D}],132:[{name:"data",type:G}],133:[{name:"lastBlockId",type:z},{name:"timeToNextBlock",type:K},{name:"nSection",type:z},{name:"nMicroblock",type:z},{name:"nOrganization",type:z},{name:"nServer",type:z},{name:"nUser",type:z},{name:"nApplication",type:z},{name:"nFlow",type:z}],134:[{name:"list",type:j,content:{type:U,schema:[{name:"id",type:z},{name:"status",type:x},{name:"timestamp",type:z},{name:"hash",type:Y},{name:"node",type:Y},{name:"size",type:z},{name:"nMicroblock",type:z}]}}],135:[{name:"header",type:D},{name:"microBlock",type:j,content:{type:U,schema:[{name:"hash",type:Y},{name:"microChainId",type:Y},{name:"type",type:x},{name:"nonce",type:K},{name:"size",type:z},{name:"nSection",type:z}]}}],136:[{name:"nonce",type:K},{name:"lastMicroblock",type:Y}],137:[{name:"list",type:j,content:{type:Y}}],138:[{name:"microChainId",type:Y},{name:"type",type:x},{name:"masterBlock",type:z},{name:"index",type:R},{name:"offset",type:R},{name:"content",type:D}],140:[{name:"microChainId",type:Y},{name:"microBlockId",type:Y},{name:"nonce",type:K}],141:[{name:"flows",type:z},{name:"records",type:z},{name:"bytes",type:z}],[_]:[{name:"id",type:K}]};$[139]=[{name:"list",type:j,content:{type:U,schema:$[138]}}];const J={0:[{key:null,def:[{name:"name",type:O}]}],1:[{key:null,def:[{name:"key",type:D}]}],2:[{key:0,def:[{name:"key",type:D}]}],3:[{key:null,def:[{name:"name",type:O},{name:"endPoint",type:O},{name:"logoUrl",type:O}]}],4:[{key:null,def:[{name:"version",type:K},{name:"definition",type:D}]}],5:[{key:null,def:[{name:"applicationId",type:G},{name:"version",type:K}]},{key:0,def:[{name:"operatorKey",type:V}]}],6:[{key:null,def:[{name:"version",type:K}]}],7:[{key:null,def:[{name:"nonce",type:K},{name:"messageId",type:K},{name:"approver",type:x}]}],8:[{key:null,def:[{name:"id",type:x},{name:"name",type:O},{name:"authType",type:x},{name:"authHash",type:Y}]},{key:1,def:[{name:"key",type:V}]},{key:2,def:[{name:"padding",type:D},{name:"authPepper",type:N},{name:"authValue",type:O}]}],9:[{key:null,def:[{name:"id",type:x},{name:"name",type:O}]},{key:1,def:[{name:"key",type:V}]}],10:[{key:null,def:[{name:"channelId",type:x},{name:"userId",type:x}]},{key:2,def:[{name:"channelKey",type:V}]}],11:[{key:null,def:[{name:"fieldList",type:D},{name:"accessRules",type:D},{name:"fieldData",type:D}]}],12:[{key:null,def:[{name:"channelId",type:x},{name:"merkleHash",type:Y}]},{key:3,def:[{name:"padding",type:D},{name:"merklePepper",type:N},{name:"fieldData",type:D}]}],13:[{key:null,def:[{name:"signature",type:D}]}]},X="cache",Q=0,W=1,Z=2,ee=3,te=4,ne=5,ae=6,re=7,ie=8,ce=9;function oe(e){switch(typeof e){case"number":return W;case"boolean":return Z;case"string":return ee;case"object":if(null===e)return ae;if(Array.isArray(e))return te;if(e instanceof Uint8Array)return re;if(e instanceof CryptoKey){if(e.algorithm.name==l.NAME)return ie;if(e.algorithm.name==u.NAME)return ce}return ne;default:return Q}}function se(e){return[...e].map((e=>e.toString(16).toUpperCase().padStart(2,"0"))).join("")}function le(e,t){return e[t]}function ue(e,t){return e[t]<<16|e[t+1]<<8|e[t+2]}function ye(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function pe(e,t){return 16777216*ue(e,t)+ue(e,t+3)}async function de(e,t){return await async function(e,t,n=null,a={}){let r=null===n?[]:[n];function i(e){r=[...r,...e]}function o(e,t){for(;t--;)r.push(e>>8*t&255)}async function s(e,n,r){if(void 0===n)throw console.error(t),`property '${r.join(".")}' is undefined`;if(!function(e,t){let n=oe(e);function a(e,t){return oe(e)==W&&e%1==0&&e>=0&&e<2**t}switch(t.type){case S:return n==te&&2==e.length&&a(e[0],32)&&a(e[1],32);case x:return a(e,8);case K:return a(e,16);case H:return a(e,24);case R:return a(e,32);case z:return a(e,48);case O:return n==ee;case U:return n==ne;case j:return n==te&&(null==t.size||t.size==e.length);case D:return n==re;case N:return n==re&&16==e.length;case G:return n==re&&32==e.length;case P:return n==re&&64==e.length;case q:return n==ne&&a(e.type,8)&&a(e.index,8)&&oe(e.key)==ie;case V:return n==ne&&a(e.type,8)&&a(e.index,8)&&oe(e.key)==ce}return!1}(n,e))throw console.error(t),`property '${r.join(".")}' has an invalid type`;switch(e.type){case S:o((u=n)[0],4),o(u[1],4);break;case x:o(n,1);break;case K:o(n,2);break;case H:o(n,3);break;case R:o(n,4);break;case z:o(n/4294967296,2),o(n,4);break;case O:{let e=(p=n,c.encode(p));o(e.length,3),i(e);break}case D:o(n.length,3),i(n);break;case N:case G:case P:i(n);break;case V:{let e=n.type<<8|n.index;o(e,2),i(await y(n.key)),a.keys&&(a.keys[e]=n.key);break}case U:await l(e.schema,n,r);break;case j:null==e.size&&o(n.length,3);for(let t in n)await s(e.content,n[t],[...r,t])}var u,p}async function l(e,t,n=[]){for(let a of e)await s(a,t[a.name],[...n,a.name])}return await l(e,t),new Uint8Array(r)}($[e],t,e)}async function fe(e,t,n={}){let a=J[e],r={keys:n},i=!1,c={},o=0;for(let e in a){let s=a[e],l=null===s.key?0:t[o++],u=t[o++]<<16|t[o++]<<8|t[o++],y=t.slice(o,o+=u);if(null!==s.key){let e=n[s.key<<8|l];if(!e){i=!0;continue}if(y=await d(e,y,p(1)),0==y)throw"invalid key"}await me(s.def,y,0,c,r)}return[c,i]}async function me(e,t,a,r={},i={}){function c(e){let n=0;for(;e--;)n=n<<8|t[a++];return n>>>0}function l(e){return t.slice(a,a+=e)}async function y(e,t){let a;switch(e.type){case S:a=[c(4),c(4)];break;case x:a=c(1);break;case K:a=c(2);break;case H:a=c(3);break;case R:a=c(4);break;case z:a=4294967296*c(2)+c(4);break;case O:r=l(c(3)),a=o.decode(r);break;case D:a=l(c(3));break;case N:a=l(16);break;case G:a=l(32);break;case P:a=l(64);break;case V:{let e=c(2),t=await async function(...e){return await async function(e,t,a=!1){let r={key_ops:["encrypt","decrypt"],kty:"oct",alg:e.ALGORITHM,k:(i=t,function(e,t,n){let a=e.length%3,r=0,i="";for(let n=0;n<e.length||n%3;)if(r=r<<8|e[n++],!(n%3)){for(let e=4;e--;)i+=t[r>>6*e&63];r=0}return a?i.slice(0,a-3)+t[64].repeat(0):i}(i,s))};var i;return await n("jwk",r,{name:e.NAME,length:e.KEY_LENGTH},a,["encrypt","decrypt"])}(u,...e)}(l(32),!0);a={type:e>>8,index:255&e,key:t},i.keys&&(i.keys[e]=t);break}case U:a={},await p(e.schema,a,t);break;case j:{let n=null==e.size?c(3):e.size;a=[];for(let r=0;r<n;r++)a[r]=await y(e.content,[...t,r]);break}}var r;return a}async function p(e,t,n=[]){for(let a of e)t[a.name]=await y(a,[...n,a.name])}if(await p(e,r),a!=t.length)throw console.error("SCHEMA",e),console.error("STREAM",t),console.error("OBJECT",r),console.trace(),`invalid stream: inconsistent length (pointer = ${a} / length = ${t.length})`;return r}let he,we;async function ke(e,t){return await async function(e,t,n){console.log("query",e,t,n);let a,r,i=await de(t,n);try{a=new Uint8Array(await he.query(e,i,"arraybuffer")),console.log("answer",a)}catch(e){return console.log("error",e),{id:_,data:{id:L}}}try{return r=await async function(e){return{id:e[0],data:await me($[e[0]],e,1)}}(a),console.log("answerData",r),r}catch(e){return console.log("error",e),{id:_,data:{id:M}}}}(we+"/query/",e,t)}var ge=Object.freeze({__proto__:null,query:async function(e,t,n,a){let r=new XMLHttpRequest;return new Promise((function(i,c){r.open("POST",e,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Content-Type","application/json"),n&&(r.responseType=n),a&&(r.withCredentials=!0),console.log(r),r.addEventListener("load",(e=>{i(r.response)})),r.addEventListener("error",(e=>{c()})),r.send(t)}))}});let be=null;const Ae="carmentis-db",ve=2,Ee=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB;let Be,Fe;function Ce(e){Fe=e}function Ie(){return!!Be||new Promise(((e,t)=>{let n=Ee.open(Ae,ve);n.onerror=function(e){t(e)},n.onsuccess=function(t){Be=n.result,e()},n.onupgradeneeded=function(e){let n=e.target.result;n.onerror=function(e){t()},e.oldVersion<1&&Fe.forEach((e=>{n.createObjectStore(e)}))}}))}async function Le(e,t){return await Ie(),new Promise(((n,a)=>{let r=Be.transaction(e,"readonly").objectStore(e).get(t);r.addEventListener("success",(function(e){n(e.target.result)})),r.addEventListener("error",(function(e){a(null)}))}))}async function Me(e,t,n){return await Ie(),new Promise(((a,r)=>{let i=Be.transaction(e,"readwrite").objectStore(e).put(n,t);i.addEventListener("success",(function(e){a(e.target.result)})),i.addEventListener("error",(function(e){r(e)}))}))}const Te=X+"-store";var _e=Object.freeze({__proto__:null,fileExists:async function(e,t){let n=e+"-"+t;return await async function(e,t){return await Ie(),new Promise(((n,a)=>{let r=Be.transaction(e,"readonly").objectStore(e).count(t);r.addEventListener("success",(function(e){n(e.target.result)})),r.addEventListener("error",(function(e){a(null)}))}))}(Te,n)},initialize:async function(e){Ce(e)},readFile:async function(e,t,n,a){let r=e+"-"+t;return await Le(Te,r)},writeFile:async function(e,t,n){let a=e+"-"+t;return await Me(Te,a,n)}});let Se;async function xe(e,t){return Se&&Se.get?await Se.get(e,t):null}async function Ke(e,t,n){return Se&&Se.get?await Se.set(e,t,n):null}const He="-store";var Re=Object.freeze({__proto__:null,del:async function(e,t){return await async function(e,t){return await Ie(),new Promise(((n,a)=>{let r=Be.transaction(e,"readwrite").objectStore(e).delete(t);r.addEventListener("success",(function(e){n(e.target.result)})),r.addEventListener("error",(function(e){a(e)}))}))}(e+He,t)},get:async function(e,t){return await Le(e+He,t)},initialize:async function(e){Ce(e.map((e=>e+He)))},set:async function(e,t,n){return await Me(e+He,t,n)}});const ze=new Uint8Array([77,73,67,82,79,66,76,75]),Oe=0,Ue=8,je=10,De=42,Ne=48,Ge=49,Pe=81,qe=145,Ve=0,Ye=1,$e=5;async function Je(e){let t={};return function(e,t){t.length<qe||function(e,t){if(!e instanceof Uint8Array||!t instanceof Uint8Array||e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}(t.slice(Oe,8),ze)&&(e.nonce=function(e,t){return e[t]<<8|e[t+1]}(t,Ue),e.prevHash=t.slice(je,je+32),e.ts=pe(t,De),e.nSection=le(t,Ne),e.bodyHash=t.slice(Ge,Ge+32),e.signature=t.slice(Pe,Pe+64))}(t,e.content),await async function(e,t){let n=qe;e.sections=[];for(let a=0;a<e.nSection;a++){let a=le(t,n+Ve),r=ye(t,n+Ye),i=t.slice(n+$e,n+$e+r);e.sections.push({type:a,size:r,data:i}),n+=$e+r}return n!=t.length?T:(e.bodyHash=await f(t.slice(qe,n)),I)}(t,e.content),t.hash=e.hash,t.microChainId=e.microChainId,t.size=e.content.length,t.masterBlock=e.masterBlock,t.type=e.type,t.index=e.index,t.offset=e.offset,t}async function Xe(e){let t=await ke(5,{id:e});if(!t.data.list)return null;let n=[],a=[],r=[];for(let e in t.data.list){let i=t.data.list[e],c="MICROBLK-"+se(i),o=await xe("cache",c);o?n[e]=o:(a.push(i),r.push(e))}if(a.length){let e=await ke(7,{list:a});for(let t in a){let i=e.data.list[t];i.hash=a[t],n[r[t]]=i,await Ke("cache","MICROBLK-"+se(i.hash),i)}}return await async function(e,t){let n={status:0,microBlock:[],currentBlock:null,currentNonce:t.length+1};n.hash=e;for(let e in t){let a=await Je(t[e]);n.microBlock.push(a)}return n}(e,n)}const Qe=at((async function(){let e=await ke(0,{});return 133!=e.id?null:e})),We=at((async function(e,t){let n=await ke(2,{firstBlockId:e,count:t});return 134!=n.id?null:n})),Ze=at((async function(e){let t=await ke(3,{id:e});if(135!=t.id)return null;let n={};return function(e,t){e.nonce=pe(t,8),e.previousHash=t.slice(14,46),e.previousTxId=t.slice(46,78),e.ts=pe(t,78),e.merkleRootHash=t.slice(84,116),e.radixRootHash=t.slice(116,148),e.nodeId=t.slice(148,180),e.nodeSignature=t.slice(180,244)}(n,t.data.header),n.hash=await f(t.data.header),n.microBlock=t.data.microBlock,n})),et=at(Xe),tt=at((async function(e){let t,n="MICROBLK-"+se(e);if(t=await xe("cache",n),!t){let a=await ke(6,{id:e});if(138!=a.id)return null;a.data.hash=e,await Ke("cache",n,a.data),t=a.data}return await Je(t)})),nt=at((async function(e){let t=await Xe(e);if(null==t)throw"Unknown application";let n=await async function(e,t){for(let n of e.microBlock)if(await t(n))return n;return null}(t,(async e=>await async function(e,t,n,a={}){for(let r of e.sections)if(console.log("findSection, trying ...",r),r.type==t){if(n){let[e]=await fe(t,r.data,a);if(console.log("findSection, data",e),!n(e))continue}return r}return null}(e,3)));if(null==n)throw"Unable to find the application description";return await async function(e,t,n={}){let a=e.sections.find((e=>e.type==t));if(null==a)return{};let[r]=await fe(t,a.data,n);return r}(n,3)}));function at(e){return function(...t){try{return e(...t)}catch(e){return console.error(e),null}}}return(rt=C).getRandomValues,t=rt.digest,rt.generateKey,rt.deriveKey,n=rt.importKey,a=rt.exportKey,rt.encrypt,r=rt.decrypt,rt.sign,rt.verify,he=ge,we="https://testnode.carmentis.io",function(e,...t){be=e,be.initialize(...t)}(_e),Se=Re,Se.initialize(["account","session",X]),e.MASTER_BLOCK_PERIOD=10,e.getApplication=nt,e.getChainStatus=Qe,e.getMasterBlock=Ze,e.getMasterBlockList=We,e.getMicroBlock=tt,e.getMicroChain=et,e;var rt}({});
